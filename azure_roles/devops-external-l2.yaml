# --- SENIOR (L2) ELEVATED ROLE DEFINITION ---
# Focus: Full provisioning, configuration, and destruction rights.
# Logic: Inherits L1 (Junior) triage actions via the Terraform stitching engine.
# Safety: Delete actions are included but should be gated via Azure PIM to mirror the AWS MFA requirement.

name: "DevOps-External-L2"
description: "Senior Contractor: Ultra-granular provisioning and destruction rights across Azure services."

actions:
  # 1. Compute & Networking (EC2 / ELB / ASG Equivalent)
  - "Microsoft.Compute/virtualMachines/write"
  - "Microsoft.Compute/virtualMachines/delete"
  - "Microsoft.Compute/virtualMachineScaleSets/write"
  - "Microsoft.Compute/virtualMachineScaleSets/delete"
  - "Microsoft.Network/loadBalancers/write"
  - "Microsoft.Network/loadBalancers/delete"
  - "Microsoft.Network/networkInterfaces/write"
  - "Microsoft.Network/networkInterfaces/delete"

  # 2. Data & Storage (RDS / S3 / DynamoDB Equivalent)
  - "Microsoft.Sql/servers/databases/write"
  - "Microsoft.Sql/servers/databases/delete"
  - "Microsoft.Sql/managedInstances/databases/write"
  - "Microsoft.Sql/managedInstances/databases/delete"
  - "Microsoft.DBforMySQL/servers/write"
  - "Microsoft.DBforMySQL/servers/delete"
  - "Microsoft.DBforPostgreSQL/servers/write"
  - "Microsoft.DBforPostgreSQL/servers/delete"
  - "Microsoft.DBforMariaDB/servers/write"
  - "Microsoft.DBforMariaDB/servers/delete"
  - "Microsoft.Storage/storageAccounts/write"
  - "Microsoft.Storage/storageAccounts/delete"
  - "Microsoft.Storage/storageAccounts/blobServices/containers/write"
  - "Microsoft.Storage/storageAccounts/blobServices/containers/delete"
  - "Microsoft.DocumentDB/databaseAccounts/write"
  - "Microsoft.DocumentDB/databaseAccounts/delete"

  # 3. Serverless, APIM & Deployment (Lambda / APIM / CloudFormation Equivalent)
  - "Microsoft.Web/sites/write"
  - "Microsoft.Web/sites/delete"
  - "Microsoft.Web/sites/functions/write"
  - "Microsoft.ApiManagement/service/*"
  - "Microsoft.Resources/deployments/write"
  - "Microsoft.Resources/deployments/delete"
  - "Microsoft.Resources/deployments/validate/action"

  # 4. Messaging, Backups & Maintenance (SQS / AWS Backup / Maintenance Equivalent)
  - "Microsoft.ServiceBus/namespaces/queues/write"
  - "Microsoft.ServiceBus/namespaces/queues/delete"
  - "Microsoft.DataProtection/backupVaults/write"
  - "Microsoft.DataProtection/backupVaults/delete"
  - "Microsoft.RecoveryServices/vaults/write"
  - "Microsoft.RecoveryServices/vaults/delete"
  - "Microsoft.Compute/snapshots/write"
  - "Microsoft.Compute/snapshots/delete"
  - "Microsoft.Maintenance/maintenanceConfigurations/*"
  - "Microsoft.Maintenance/applyUpdates/*"

  # 5. Network Guardrails (Security Rules)
  - "Microsoft.Network/networkSecurityGroups/securityRules/write"
  - "Microsoft.Network/networkSecurityGroups/securityRules/delete"

notActions:
  # Prevents self-escalation or modifying core VNET architecture
  - "Microsoft.Network/virtualNetworks/*"
  - "Microsoft.Authorization/roleAssignments/write"
  - "Microsoft.Authorization/roleDefinitions/write"

assignableScopes:
  - "/subscriptions/${var.subscription_id}"
