# --- SENIOR (L2) ELEVATED ROLE DEFINITION ---
# Focus: Broad provisioning and configuration rights for senior contractors.
# Compliance: Strict No-Wildcard enforcement. All actions are explicitly listed.
# Inheritance: Inherits L1 (Junior) triage actions via the Terraform stitching engine.

name: "DevOps-External-L2"
description: "Senior Contractor: Broad operational and provisioning rights with destructive and RBAC guardrails."

actions:
  # 1. Compute, Networking & Optimization
  - "Microsoft.Compute/virtualMachines/read"
  - "Microsoft.Compute/virtualMachines/write"
  - "Microsoft.Compute/virtualMachines/start/action"
  - "Microsoft.Compute/virtualMachines/restart/action"
  - "Microsoft.Compute/virtualMachines/powerOff/action"
  - "Microsoft.Compute/virtualMachineScaleSets/read"
  - "Microsoft.Compute/virtualMachineScaleSets/write"
  - "Microsoft.Network/loadBalancers/read"
  - "Microsoft.Network/loadBalancers/write"
  - "Microsoft.Network/networkInterfaces/read"
  - "Microsoft.Network/networkInterfaces/write"
  - "Microsoft.Network/networkSecurityGroups/securityRules/read"
  - "Microsoft.Network/networkSecurityGroups/securityRules/write"
  - "Microsoft.Advisor/recommendations/read"
  - "Microsoft.ResourceHealth/availabilityStatuses/read"

  # 2. Data & Storage (SQL, OSS DBs, Storage, CosmosDB)
  - "Microsoft.Sql/servers/databases/read"
  - "Microsoft.Sql/servers/databases/write"
  - "Microsoft.Sql/managedInstances/databases/read"
  - "Microsoft.Sql/managedInstances/databases/write"
  - "Microsoft.DBforMySQL/servers/read"
  - "Microsoft.DBforMySQL/servers/write"
  - "Microsoft.DBforPostgreSQL/servers/read"
  - "Microsoft.DBforPostgreSQL/servers/write"
  - "Microsoft.Storage/storageAccounts/read"
  - "Microsoft.Storage/storageAccounts/write"
  - "Microsoft.Storage/storageAccounts/listKeys/action"
  - "Microsoft.DocumentDB/databaseAccounts/read"
  - "Microsoft.DocumentDB/databaseAccounts/write"

  # 3. Serverless, APIM & Deployment
  - "Microsoft.Web/sites/read"
  - "Microsoft.Web/sites/write"
  - "Microsoft.Web/sites/config/read"
  - "Microsoft.Web/sites/config/write"
  - "Microsoft.ApiManagement/service/read"
  - "Microsoft.ApiManagement/service/write"
  - "Microsoft.Resources/deployments/read"
  - "Microsoft.Resources/deployments/write"
  - "Microsoft.Resources/deployments/validate/action"

  # 4. Messaging & Events
  - "Microsoft.ServiceBus/namespaces/queues/read"
  - "Microsoft.ServiceBus/namespaces/queues/write"
  - "Microsoft.ServiceBus/namespaces/topics/read"
  - "Microsoft.ServiceBus/namespaces/topics/write"
  - "Microsoft.EventGrid/topics/read"
  - "Microsoft.EventGrid/topics/write"

  # 5. Security, Keys & Secrets
  - "Microsoft.KeyVault/vaults/read"
  - "Microsoft.KeyVault/vaults/write"
  - "Microsoft.KeyVault/vaults/keys/read"
  - "Microsoft.KeyVault/vaults/keys/write"
  - "Microsoft.KeyVault/vaults/secrets/read"
  - "Microsoft.KeyVault/vaults/secrets/write"
  - "Microsoft.KeyVault/vaults/accessPolicies/write"

  # 6. Backups & Maintenance
  - "Microsoft.DataProtection/backupVaults/read"
  - "Microsoft.DataProtection/backupVaults/write"
  - "Microsoft.RecoveryServices/vaults/read"
  - "Microsoft.RecoveryServices/vaults/write"
  - "Microsoft.Compute/snapshots/read"
  - "Microsoft.Compute/snapshots/write"
  - "Microsoft.Maintenance/maintenanceConfigurations/read"
  - "Microsoft.Maintenance/maintenanceConfigurations/write"
  - "Microsoft.Maintenance/applyUpdates/write"
  - "Microsoft.Authorization/policyDefinitions/read"
  - "Microsoft.Authorization/policyDefinitions/read"
  - "Microsoft.Authorization/policyAssignments/read"
  - "Microsoft.Authorization/policyAssignments/read"
  - "Microsoft.Authorization/roleAssignments/read"
  - "Microsoft.Authorization/roleAssignments/read"
  - "Microsoft.KeyVault/vaults/secrets/get"
  - "Microsoft.KeyVault/vaults/read"
  - "Microsoft.Compute/virtualMachines/read"
  - "Microsoft.Compute/virtualMachines/extensions/read"

  # 7. Insights & Governance
  - "Microsoft.Insights/components/read"
  - "Microsoft.Insights/components/write"
  - "Microsoft.Insights/metrics/read"
  - "Microsoft.Insights/logDefinitions/read"
  - "Microsoft.Insights/eventtypes/values/read"
  - "Microsoft.Support/supportTickets/read"
  - "Microsoft.Support/supportTickets/write"

notActions:
  - "*/delete"
  - "Microsoft.Network/virtualNetworks/*"
  - "Microsoft.Authorization/roleAssignments/write"
  - "Microsoft.Authorization/roleAssignments/delete"
  - "Microsoft.Authorization/roleDefinitions/write"
  - "Microsoft.Authorization/roleDefinitions/delete"
  - "Microsoft.Authorization/policyAssignments/write"
  - "Microsoft.Authorization/policyDefinitions/write"

assignableScopes:
  - "/subscriptions/${var.subscription_id}"
